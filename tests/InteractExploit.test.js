import { Nadagotchi } from '../js/Nadagotchi';
import { Config } from '../js/Config';

// Mock localStorage
class LocalStorageMock {
    constructor() { this.store = {}; }
    clear() { this.store = {}; }
    getItem(key) { return this.store[key] || null; }
    setItem(key, value) { this.store[key] = String(value); }
    removeItem(key) { delete this.store[key]; }
}
global.localStorage = new LocalStorageMock();

// Mock Phaser
const Phaser = {
    Utils: {
        Array: {
            GetRandom: (arr) => arr[0]
        }
    }
};
global.Phaser = Phaser;

describe('Interact Exploit Fix', () => {
    let pet;

    beforeEach(() => {
        pet = new Nadagotchi('Adventurer');
        // Ensure standard stats
        pet.stats.energy = 100;
        pet.relationships['Grizzled Scout'] = { level: 0 };
    });

    test('interact (CHAT) should consume energy', () => {
        const initialEnergy = pet.stats.energy;
        pet.interact('Grizzled Scout');
        // Expect energy to drop (assuming we add a cost, e.g., 5)
        expect(pet.stats.energy).toBeLessThan(initialEnergy);
    });

    test('interact should fail (return null) if insufficient energy', () => {
        pet.stats.energy = 0; // Too tired
        const result = pet.interact('Grizzled Scout');
        expect(result).toBeNull();
    });
});
